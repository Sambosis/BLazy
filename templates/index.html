<!DOCTYPE html>
<html>
<head>
    <title>Computer Use Demo</title>
    <style>
        #output {
            white-space: pre-wrap;
            font-family: monospace;
            padding: 10px;
            border: 1px solid #ccc;
            min-height: 200px;
            max-height: 800px; /* Increased height for more content */
            overflow-y: auto;
            background-color: #1e1e1e;
            color: #ffffff;
        }
        .iteration, .awaiting-input {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background-color: #292929;
        }
        .user-message, .assistant-message, .token-section, .info-section, .error-section {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .user-message {
            background-color: #2e2e2e;
        }
        .assistant-message {
            background-color: #3e3e3e;
        }
        .token-section {
            background-color: #1e403f;
        }
        .info-section {
            background-color: #1e403f;
        }
        .error red {
            color: red;
        }
        .tool-use {
            margin-left: 20px;
            padding: 5px;
            border-left: 2px solid #666;
        }
        .tool-input {
            margin-left: 10px;
            color: #888;
        }
        /* Add styles for formatting */
        .yellow { color: yellow; }
        .blue { color: blue; }
        .green { color: green; }
        .cyan { color: cyan; }
        .red { color: red; }
        /* Styling for images */
        #output img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Computer Use Demo in Web Browser</h1>
    <form id="taskForm">
        <label for="task">Enter Task:</label><br>
        <textarea id="task" name="task" rows="4" cols="50"></textarea><br>
        <input type="submit" value="Run Task">
    </form>

    <h2>Output:</h2>
    <div id="output"></div>

    <script>
        document.getElementById('taskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const task = document.getElementById('task').value;
            fetch('/task', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({task: task})
            }).then(response => {
                if (!response.ok) {
                    console.error('Network response was not ok');
                    // Optionally, display an error message to the user
                    writeError("Failed to submit task. Please try again.");
                }
            }).catch(error => {
                console.error('Fetch error:', error);
                // Optionally, display an error message to the user
                writeError("An error occurred while submitting the task.");
            });
            document.getElementById('task').value = '';
        });

        const outputContainer = document.getElementById('output');
        const eventSource = new EventSource("/stream");
        
        eventSource.onmessage = function(event) {
            if (event.data) {
                // Append the incoming HTML directly
                outputContainer.insertAdjacentHTML('beforeend', event.data);
                
                // Scroll to bottom
                outputContainer.scrollTop = outputContainer.scrollHeight;
            }
        };

        eventSource.onerror = function(error) {
            console.error("EventSource failed:", error);
            // Optionally, display an error message to the user
            writeError("Connection lost. Please refresh the page.");
        };

        function writeError(message) {
            const errorHtml = `<div class="error-section"><p class="red">${message}</p></div>`;
            outputContainer.insertAdjacentHTML('beforeend', errorHtml);
            outputContainer.scrollTop = outputContainer.scrollHeight;
        }
    </script>
</body>
</html>